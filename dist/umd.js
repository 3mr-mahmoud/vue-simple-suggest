!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.vueSimpleSuggest=e()}(this,function(){"use strict";const t={selectionUp:[38],selectionDown:[40],select:[13],hideList:[27],autocomplete:[32,13]},e={input:String,select:Object},s={type:String},i={type:s,accesskey:s,autocomplete:s,form:s,formaction:s,formenctype:s,formmethod:s,formtarget:s,height:s,width:s,inputmode:s,max:s,min:s,minlength:s,maxlength:s,name:s,pattern:s,placeholder:s,selectionDirection:s,selectionEnd:s,selectionStart:s,size:s,src:s,step:s,tabindex:s,title:s,spellcheck:{},readonly:{},required:{},multiple:{},formnovalidate:{},autofocus:{},checked:{},disabled:{}};function n(t,e){return e.split(".").reduce((t,e)=>t===Object(t)?t[e]:t,t)}function o(t,e){if(t.length<=0)return!1;const s=t=>t.some(t=>t===e.keyCode);return Array.isArray(t[0])?t.some(t=>s(t)):s(t)}let l="input";return{render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"vue-simple-suggest"},[s("div",{ref:"inputSlot",staticClass:"input-wrapper",class:{designed:!t.destyled},on:{click:t.onInputClick,input:t.onInput,keydown:t.onArrowKeyDown,keyup:function(e){t.onListKeyUp(e),t.onAutocomplete(e)}}},[t._t("default",[s("input",t._b({staticClass:"default-input",domProps:{value:t.text||""}},"input",t.$props,!1))])],2),t._v(" "),!t.listShown||t.removeList||t.miscSlotsAreEmpty()?t._e():s("div",{staticClass:"suggestions",class:{designed:!t.destyled}},[t._t("misc-item-above",null,{suggestions:t.suggestions,query:t.text}),t._v(" "),t._l(t.suggestions,function(e,i){return s("div",{key:t.isPlainSuggestion?"suggestion-"+i:t.valueProperty(e),staticClass:"suggest-item",class:{selected:t.selected&&t.valueProperty(e)==t.valueProperty(t.selected),hover:t.hovered&&t.valueProperty(t.hovered)==t.valueProperty(e)},on:{mouseenter:function(s){t.hover(e,s.target)},mouseleave:function(e){t.hover(null,e.target)}}},[t._t("suggestion-item",[s("span",[t._v(t._s(t.displayProperty(e)))])],{suggestion:e,query:t.text})],2)}),t._v(" "),t._t("misc-item-below",null,{suggestions:t.suggestions,query:t.text})],2)])},staticRenderFns:[],name:"vue-simple-suggest",model:{prop:"value",get event(){return l}},props:Object.assign({},i,{controls:{type:Object,default:()=>t},minLength:{type:Number,default:1},maxSuggestions:{type:Number,default:10},displayAttribute:{type:String,default:"title"},valueAttribute:{type:String,default:"id"},list:{type:[Function,Array],default:()=>[]},removeList:{type:Boolean,default:!1},destyled:{type:Boolean,default:!1},filterByQuery:{type:Boolean,default:!1},filter:{type:Function,default(t){return!value||~this.displayProperty(t).toLowerCase().indexOf(value.toLowerCase())}},debounce:{type:Number,default:0},value:{},mode:{type:String,default:l,validator:t=>!!~Object.keys(e).indexOf(t.toLowerCase())}}),watch:{mode:t=>l=t},data(){return{selected:null,hovered:null,suggestions:[],listShown:!1,inputElement:null,canSend:!0,timeoutInstance:null,text:this.value,isPlainSuggestion:!1,controlScheme:{}}},computed:{slotIsComponent(){return this.$slots.default&&this.$slots.default.length>0&&!!this.$slots.default[0].componentInstance},listIsRequest(){return"function"==typeof this.list},input(){return this.slotIsComponent?this.$slots.default[0].componentInstance:this.inputElement},on(){return this.slotIsComponent?"$on":"addEventListener"},off(){return this.slotIsComponent?"$off":"removeEventListener"},hoveredIndex(){return this.suggestions.findIndex(t=>this.hovered&&this.valueProperty(this.hovered)==this.valueProperty(t))}},created(){this.controlScheme=Object.assign({},t,this.controls),l=this.mode},mounted(){this.inputElement=this.$refs.inputSlot.querySelector("input"),this.input[this.on]("blur",this.onBlur),this.input[this.on]("focus",this.onFocus),console.log(this)},beforeDestroy(){this.input[this.off]("blur",this.onBlur),this.input[this.off]("focus",this.onFocus)},methods:{miscSlotsAreEmpty(){const t=t=>this.$scopedSlots["misc-item-"+t];return["above","below"].some(e=>(e=>t(e)&&"function"==typeof t(e))(e)?!t(e)(this):!t(e))},displayProperty(t){return(this.isPlainSuggestion?t:n(t,this.displayAttribute))+""},valueProperty(t){return this.isPlainSuggestion?t:n(t,this.valueAttribute)},select(t){this.hovered=null,this.selected=t,this.$emit("select",t),this.$emit("input",this.displayProperty(t)),this.inputElement.value=this.displayProperty(t),this.text=this.displayProperty(t),this.inputElement.focus()},hover(t,e){this.hovered=t,null!=this.hovered&&this.$emit("hover",t,e)},hideList(t=!1){this.listShown&&(this.hovered&&!t&&this.select(this.hovered),this.listShown=!1,this.$emit("hide-list"))},showList(){!this.listShown&&this.text&&this.text.length>=this.minLength&&this.suggestions.length>0&&(this.listShown=!0,this.$emit("show-list"))},async onInputClick(t){0!==this.minLength||this.text||await this.research(),this.showList()},onArrowKeyDown(t){if(o([this.controlScheme.selectionUp,this.controlScheme.selectionDown],t)){t.preventDefault(),this.showList();const e=o(this.controlScheme.selectionDown,t),s=2*e-1,i=e?0:this.suggestions.length-1,n=e?this.hoveredIndex<this.suggestions.length-1:this.hoveredIndex>0;let l=null;l=this.hovered?n?this.suggestions[this.hoveredIndex+s]:this.suggestions[i]:this.selected||this.suggestions[i],this.hover(l)}},onListKeyUp(t){const e=this.controlScheme.select,s=this.controlScheme.hideList;o([e,s],t)&&(t.preventDefault(),this.listShown?this.hideList(o(s,t)):o(e,t)&&this.research())},onAutocomplete(t){o(this.controlScheme.autocomplete,t)&&(t.ctrlKey||t.shiftKey)&&(t.preventDefault(),this.select(this.suggestions[0]),this.hover(this.suggestions[0]))},onBlur(t){this.hideList(),this.$emit("blur",t)},onFocus(t){this.$emit("focus",t),this.showList()},onInput(t){this.text=t.target.value,this.$emit("input",this.text),this.selected&&(this.selected=null,this.$emit("select",null)),this.debounce?(clearTimeout(this.timeoutInstance),this.timeoutInstance=setTimeout(this.research,this.debounce)):this.research()},async research(){try{this.canSend&&(this.canSend=!1,this.$set(this,"suggestions",await this.getSuggestions(this.text)),this.canSend=!0)}catch(t){throw this.clearSuggestions(),t}finally{return this.$nextTick(()=>{0===this.suggestions.length&&this.miscSlotsAreEmpty()?this.hideList(!0):this.showList()}),this.suggestions}},async getSuggestions(t=""){if(this.listShown&&!t)return this.hideList(),this.clearSuggestions(),this.suggestions;if(this.minLength>0&&t.length<this.minLength)return this.suggestions;this.selected=null,this.listIsRequest&&this.$emit("request-start",t);let e=[];try{e=this.listIsRequest?await this.list(t)||[]:this.list,Array.isArray(e)||(e=[e]),"object"!=typeof e[0]||Array.isArray(e[0])?this.isPlainSuggestion=!0:this.isPlainSuggestion=!1,this.filterByQuery&&(e=e.filter(this.filter)),this.listIsRequest&&this.$emit("request-done",e)}catch(t){if(!this.listIsRequest)throw t;this.$emit("request-failed",t)}finally{return this.maxSuggestions&&e.splice(this.maxSuggestions),e}},clearSuggestions(){this.suggestions.splice(0)}}}});
